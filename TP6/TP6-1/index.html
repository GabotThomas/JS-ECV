<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>TP6 JS</title>
    </head>
    <body>
        <script>
            const vowels = ["A","E","I","O","U"];
            const monthLetter = ["A","B","C","D","E","H","L","M","P","R","S","T"]

            const insufficientConsonants = (word) =>{
                if(word.length >= 3){
                    return word.join('').slice(0,3);
                }

                return(word.concat(["X","X","X"]).join('').slice(0,3));
            }

            const extractFirstPart = (array) => {
                const consonants = array.filter(
                    consonant => !vowels.some(vowel => vowel == consonant)
                );

                if(consonants.length >= 3){
                    return consonants.join('').slice(0,3);
                }
                
                return insufficientConsonants(
                    consonants.concat(
                        array.filter(
                            consonant => vowels.some(vowel => vowel == consonant)
                        )
                    )
                );
            }
            
            const extractSecondPart = (array) => {
                const consonants = array.filter(
                    consonant => !vowels.some(vowel => vowel == consonant)
                );
                if(consonants.length === 3){
                    return consonants.join("");
                }
                if(consonants.length > 3){
                    consonants.splice(1,1);
                    return consonants.join("").slice(0,3);
                }

                return insufficientConsonants(
                    consonants.concat(
                        array.filter(
                            consonant => vowels.some(vowel => vowel == consonant)
                        )
                    )
                );
            }

            const extractThirdPart = (date,gender)=>{
                const [day,month,year] = date.split("/");
                return (year.slice(2) 
                + monthLetter[parseInt(month)-1]
                + (gender == "F" ? 
                    (parseInt(day) + 40) :
                    ('0'+day).slice(-2)))
                ;
            }

            const fiscalCode = ({name,surname,dob,gender}) => {
                const firstPart = extractFirstPart(surname.toUpperCase().split(""));
                const secondPart = extractSecondPart(name.toUpperCase().split(""));
                const thirdPart = extractThirdPart(dob,gender);
                return firstPart.concat(secondPart.concat(thirdPart));
            }
            
            console.log(
                fiscalCode({
                    name: "Matt",
                    surname: "Edabit",
                    gender: "M",
                    dob: "1/1/1900"
                }) //"DBTMTT00A01"
                ,
                fiscalCode({
                    name: "Helen",
                    surname: "Yu",
                    gender: "F",
                    dob: "1/12/1950"
                }) //"YUXHLN50T41"
                ,
                fiscalCode({
                    name: "Mickey",
                    surname: "Mouse",
                    gender: "M",
                    dob: "16/1/1928"
                }) // "MSOMKY28A16"
            )
          

        </script>
    </body>
</html>
